---
title: 前端自动化UI测试的完整方案
date: 2023-01-06 18:00:01
toc: true
tags:
    - 每日更新
    - 技术分享
---

# 背景

开发公共平台项目，测试资源相对比较少，因此对开发者自身而言，为了维护项目的稳定性，需要对平台做各类测试，即使有测试环境，但是也很容易缺乏测试场景导致带着bug上线的情况。

因此我们需要做完整自动化测试方案，来避免这类常规错误，提高平台的可用性和稳定性。

这里先简单描述自动化测试的分类：

- 单元测试，验证独立的单元模块代码或函数是否正常工作
- 集成测试，验证多个单元模块间的协同工作
- UI 测试，只针对前端UI部分测试，后端数据采用mock方式
- 端到端测试，从用户的角度，通过机器来模仿用户在真实浏览器中验证应用交互
- 快照测试，验证程序的UI变化

接下来我们将根据这些测试类如何在项目中落地完整方案。

<!-- more -->

# 单元测试
前端项目主要用的单元测试框架为`Jest`和`Mocha`，下面就`Jest`框架如何实现一个单元测试。

## 实现步骤

1. 安装依赖
```shell
npm i jest --save-dev
# 如果是typescript还需要安装 ts
npm i ts-jest babel-jest --save-dev
# 安装类型
npm i @types/jest --save-dev
```

2. 新增测试命令，在`package.json`中`scripts`新增代码
```js
{
    ...
    "scripts": {
        "test": "node --experimental-vm-modules node_modules/jest/bin/jest.js",
  },
}
```

3. 新增配置文件`jest.config.js`，参考配置如下：
```js
module.exports = {
    "testEnvironment": "node",
    testMatch: [ //匹配测试用例的文件
        '<rootDir>/test/**/*.test.ts'
    ],
    transform: {
        '^.+\\.js$': '<rootDir>/node_modules/babel-jest', // babel编译
        '^.+\\.ts$': '<rootDir>/node_modules/ts-jest', // typescript编译
    },
    "collectCoverage": true
}
```

4. 编写单元测试代码，在根目录下新建测试文件`test/sum.test.js`，标识对`a.ts`文件做测试，代码如下：

```js
//sum.ts
export const sum = (a, b) => {
    return a + b;
}

//sum.test.ts
import { sum } from '../src/sum'

test("test two num sum", async () => {
    const res = sum(5, 6);
    expect(typeof res).toBe("number")
    expect(res).toBe(11)
})
```

5. 开始自动化测试`yarn test`或者`npm run test`，然后会出现如下：

```shel
PASS  ./sum.test.ts
----------|---------|----------|---------|---------|-------------------
File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
----------|---------|----------|---------|---------|-------------------
All files |     100 |      100 |     100 |     100 |                   
 sum.ts   |     100 |      100 |     100 |     100 |                   
----------|---------|----------|---------|---------|-------------------
Test Suites: 1 passed, 1 total
Tests:       1 passed, 1 total
Snapshots:   0 total
Time:        1.394 s, estimated 3 s
```
简单说明一下上面的表格几个字段作用：

- File，标识当前测试的文件
- Stmts，语句覆盖率（statement coverage）：是不是每个语句都执行了
- Branch，分支覆盖率（branch coverage）：是不是每个if代码块都执行了
- Funcs，函数覆盖率（function coverage）：是不是每个函数都调用了
- Lines，行覆盖率（line coverage）：是不是每一行都执行了

## 怎么提高单元测试覆盖率

分为两个部分：

- 提高代码质量，减少代码块的大小，减少各类复杂逻辑判断，不去测试有依赖性函数，如：需接口、数据库等
- 提高开发意愿，一自动化生成单元测试，二采用设置覆盖率指标，三是确定单元测试规范（哪些模块需要写，哪些不需要写）

# 集成测试

# UI 测试

# 快照测试

# 参考资料

[把 puppeteer 融入调试流程，调试体验爽翻了！](https://mp.weixin.qq.com/s?__biz=Mzg3OTYzMDkzMg==&mid=2247493866&idx=1&sn=c4a3d5ddf6e3148360f3de9ea32e018f&chksm=cf0327d1f874aec72d630aa81d7b1b0b0961943287fbab023e6d39d466f33b642e12ca7f1ac0&token=953834215&lang=zh_CN#rd)

[JS最佳测试实践](https://github.com/goldbergyoni/javascript-testing-best-practices?utm_source=gold_browser_extension)