# 字幕规则说明

## 字幕显示模式

视频字幕采用**逐行显示模式**，每次只显示一句完整的话。

### 规则要点

1. **逐行显示**：每个字幕条目显示一句完整的话
2. **不合并显示**：不将多句话合并在一起显示
3. **时长同步**：每句话的时长根据音频实际时长设置
4. **语音同步**：确保字幕与语音完全同步

### 字幕文件格式

```json
[
  {
    "text": "这是第一句话",
    "startMs": 0,
    "endMs": 2000,
    "timestampMs": 0,
    "confidence": 1.0
  },
  {
    "text": "这是第二句话",
    "startMs": 2000,
    "endMs": 4000,
    "timestampMs": 2000,
    "confidence": 1.0
  }
]
```

### 字段说明

- `text`: 字幕文本内容（一句完整的话）
- `startMs`: 开始时间（毫秒）
- `endMs`: 结束时间（毫秒）
- `timestampMs`: 时间戳（毫秒，通常等于startMs）
- `confidence`: 置信度（0-1之间，通常为1.0）

### 字幕样式

#### 移动端优化设计（文字描边版）

为了在手机屏幕上获得最佳可读性和视觉美感，字幕采用以下样式：

- **位置**：底部居中，距离底部 120px
- **字体大小**：48px（大字体，手机端清晰可读）
- **字体粗细**：800（超粗体）
- **字体家族**：圆润字体优先
  - 中文：`PingFang SC`（苹方）、`Hiragino Sans GB`（冬青黑体）、`Microsoft YaHei`（微软雅黑）
  - 英文：`Helvetica Neue`、`Arial`
  - 备用：`sans-serif`
- **颜色**：纯白色 `#FFFFFF`
- **背景**：透明 `transparent`（无背景，更清爽）
- **文字描边**：3px 粉色描边 `#FF69B4`（Hot Pink）
  - 使用 `WebkitTextStroke: "3px #FF69B4"`
  - 使用 `paintOrder: "stroke fill"` 确保描边在文字下方
- **文字阴影**：多层阴影增强对比度
  - 主阴影：`0 4px 8px rgba(0,0,0,0.9)`
  - 次阴影：`0 2px 4px rgba(0,0,0,0.8)`
  - 光晕：`0 0 20px rgba(0,0,0,0.5)`
- **圆角**：16px（更圆润）
- **内边距**：20px 40px（更宽松）
- **最大宽度**：90%
- **字间距**：0.5px（更舒适的阅读体验）
- **行高**：1.5（更好的垂直间距）

#### 设计理念

1. **高对比度**：白色文字 + 粉色描边 + 多层黑色阴影，确保在任何背景下都清晰可见
2. **大字体**：48px 字体在手机屏幕上足够大，易于阅读
3. **圆润字体**：使用系统圆体字体，视觉更友好
4. **文字描边**：3px 粉色描边直接作用在文字上，活泼可爱，适合教育类视频
5. **透明背景**：无背景色，让视频内容更突出，视觉更清爽
6. **阴影层次**：多层黑色阴影提供深度感和立体感，确保文字可读性
7. **描边技术**：使用 CSS `WebkitTextStroke` 和 `paintOrder` 实现完美的文字描边效果

### 时长计算规则

每个场景的时长 = 音频时长 + 30帧缓冲时间（1秒）

这个缓冲时间确保：
1. 声音能够播放完整
2. 观看用户有时间反应和理解内容

### 示例

#### Scene 1 字幕示例

```json
[
  {
    "text": "无监督学习",
    "startMs": 0,
    "endMs": 2180,
    "timestampMs": 0,
    "confidence": 1.0
  },
  {
    "text": "5分钟AI",
    "startMs": 2180,
    "endMs": 3633,
    "timestampMs": 2180,
    "confidence": 1.0
  },
  {
    "text": "每天搞懂一个知识点",
    "startMs": 3633,
    "endMs": 5813,
    "timestampMs": 3633,
    "confidence": 1.0
  }
]
```

每句话独立显示，不会合并。

### 技术实现

字幕组件 `CaptionComponent.tsx` 使用以下逻辑：

1. 根据当前帧计算时间（毫秒）
2. 查找当前时间范围内的字幕条目
3. 显示匹配的单条字幕文本
4. 不使用 TikTok 风格的合并显示

### 注意事项

1. 字幕文件必须放在 `public/UnsupervisedLearningVideo/` 目录下
2. 文件命名格式：`scene{N}-captions.json`
3. 时间戳必须精确，确保与音频同步
4. 每句话的时长应该合理，不要太短或太长
5. 字幕文本应该简洁明了，易于阅读

### 生成字幕的工具

使用 `tts_unsupervised.py` 脚本可以：
1. 生成音频文件
2. 自动更新字幕文件的时长
3. 确保音频和字幕同步

```bash
python tts_unsupervised.py
```

### 后续规则

**所有新的字幕文件都必须遵循此规则**：
- 逐行显示
- 一句一条
- 时长精确
- 语音同步
