# 视频制作规则文档

## 📋 概述
本文档定义了使用 Remotion 制作视频时必须遵循的标准规则和最佳实践。

---

## ⭐ 核心规则

### 1. 场景时长计算规则（必须遵守）

**规则**: 每个带音频的场景必须增加 **30帧（1秒）** 的缓冲时间

**计算公式**:
```
场景帧数 = (音频时长秒数 × 30fps) + 30帧缓冲
```

**示例**:
- 音频时长: 8.72秒
- 音频帧数: 8.72 × 30 = 262帧
- 缓冲帧数: 30帧
- **最终场景帧数**: 262 + 30 = **292帧**

**目的**:
1. ✅ 确保音频能够完整播放
2. ✅ 给观看用户足够的反应和理解时间
3. ✅ 场景切换更加自然流畅
4. ✅ 避免音频被突然截断

**适用范围**:
- 所有带音频旁白的场景
- 所有教学类视频
- 所有需要用户理解内容的场景

---

## 📐 技术规范

### 视频参数
- **帧率**: 30fps（固定）
- **分辨率**: 1920×1080（推荐）
- **音频音量**: 0.8（80%，可根据需要调整）

### 场景结构
```tsx
<TransitionSeries.Sequence durationInFrames={音频帧数 + 30}>
  <AbsoluteFill>
    {/* 场景内容 */}
    <Html5Audio src={音频文件} volume={0.8} />
    <CaptionComponent captions={字幕数据} />
  </AbsoluteFill>
</TransitionSeries.Sequence>
```

### 转场效果
- 转场时长: 15-30帧（0.5-1秒）
- 转场类型: 根据场景内容选择合适的效果
- 转场时长不计入场景时长

---

## 🎬 制作流程

### 1. 准备阶段
1. 编写脚本内容
2. 生成音频文件（使用 TTS）
3. 生成字幕文件（自动生成时间戳）
4. 获取音频时长

### 2. 计算阶段
1. 读取音频文件时长（秒）
2. 计算音频帧数：`音频秒数 × 30`
3. 添加缓冲帧数：`音频帧数 + 30`
4. 得到最终场景帧数

### 3. 实现阶段
1. 设置场景 `durationInFrames` 为最终帧数
2. 添加 `Html5Audio` 组件
3. 添加 `CaptionComponent` 组件
4. 配置转场效果

### 4. 验证阶段
1. 预览视频，检查音频是否完整播放
2. 检查字幕是否同步
3. 检查场景切换是否自然
4. 确认缓冲时间是否足够

---

## 📊 时长计算示例

### 单场景计算
```
音频时长: 10.5秒
音频帧数: 10.5 × 30 = 315帧
缓冲帧数: 30帧
场景帧数: 315 + 30 = 345帧
场景时长: 345 ÷ 30 = 11.5秒
```

### 多场景视频总时长
```
场景1: 292帧 (9.73秒)
场景2: 356帧 (11.87秒)
场景3: 284帧 (9.47秒)
转场1: 20帧 (0.67秒)
转场2: 25帧 (0.83秒)

总帧数: 292 + 20 + 356 + 25 + 284 = 977帧
总时长: 977 ÷ 30 = 32.57秒
```

---

## 🔧 工具和脚本

### TTS 音频生成
- 脚本: `tts_unsupervised.py`
- 功能: 生成音频并自动更新字幕时长
- 输出: 音频文件 + 字幕JSON文件

### 字幕格式
```json
{
  "audioDurationMs": 8720,
  "captions": [
    {
      "text": "字幕文本",
      "startTimeMs": 0,
      "endTimeMs": 2000
    }
  ]
}
```

---

## ✅ 检查清单

在完成视频制作后，请确认以下事项：

- [ ] 每个场景都增加了30帧缓冲
- [ ] 音频文件全部存在且可播放
- [ ] 字幕文件全部存在且格式正确
- [ ] 场景时长 = 音频帧数 + 30帧
- [ ] 音频音量设置合理（推荐0.8）
- [ ] 字幕与音频完美同步
- [ ] 转场效果自然流畅
- [ ] 预览视频无音频截断
- [ ] 总时长计算正确

---

## 📝 版本历史

### v1.0 (2026-02-10)
- 初始版本
- 定义30帧缓冲规则
- 建立标准制作流程

---

## 🎯 最佳实践

1. **始终遵循30帧缓冲规则** - 这是最重要的规则
2. **音频优先** - 先生成音频，再根据音频时长设置场景
3. **自动化** - 使用脚本自动生成音频和字幕
4. **预览验证** - 制作完成后必须预览检查
5. **文档记录** - 为每个视频创建时长说明文档

---

## 📚 相关文档

- [Remotion 官方文档](https://www.remotion.dev/)
- [无监督学习视频时长更新说明](./UNSUPERVISED_VIDEO_DURATION_UPDATE.md)
- [TTS 脚本使用说明](./tts_unsupervised.py)

---

## 💡 注意事项

1. **不要忽略缓冲时间** - 即使音频很短，也要添加30帧缓冲
2. **转场时长独立** - 转场时长不计入场景时长，是额外添加的
3. **结尾场景** - 结尾场景可以根据需要调整缓冲时间
4. **音频质量** - 确保音频清晰，无杂音
5. **字幕可读性** - 字幕字体大小、颜色要清晰可读

---

**记住**: 这些规则不是建议，而是**必须遵守的标准**！🎯
